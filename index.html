<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fishly-AI ‚Äî Dock Fishing (Clock + Feeding Frenzy)</title>
<style>
  :root{--bg:#061a2a;--ink:#e8f1f2;--muted:#9fb3c8;--panel:#0b1f33;--accent:#2bb673;--danger:#ff6b6b;--gold:#f5c542}
  *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
  header{padding:10px 12px;text-align:center;border-bottom:1px solid #0c2c47}
  header h1{margin:0;font-size:18px} header small{color:var(--muted)}
  canvas{display:block;width:100vw;height:100vh;background:#06243a}
  .clock{position:fixed;right:12px;top:12px;z-index:8;background:rgba(12,30,50,.86);border:1px solid #134668;color:#dff4ff;padding:6px 10px;border-radius:10px;font-weight:700;font-variant-numeric:tabular-nums;box-shadow:0 6px 18px rgba(0,0,0,.35)}
  .clock small{display:block;color:#9fb3c8;margin-top:2px}
  .clock .frenzy{color:#f5c542}
  .dockHUD{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;z-index:7;background:linear-gradient(180deg,rgba(20,35,55,.92),rgba(10,22,40,.92));border:1px solid #0f3659;border-radius:12px;padding:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;box-shadow:0 10px 30px rgba(0,0,0,.45)}
  .badge{padding:4px 8px;border-radius:999px;background:#0e3555;border:1px solid #154a73;color:#d1e6f7;font-size:.85rem}
  .btn{background:var(--accent);border:none;border-radius:10px;padding:9px 12px;color:#06212f;font-weight:800;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed} .btn.danger{background:var(--danger);color:#3a0b0b}
  .meter{position:fixed;left:50%;transform:translateX(-50%);bottom:92px;z-index:6;width:min(720px,94vw);height:22px;border-radius:10px;overflow:hidden;background:#082132;border:1px solid #0e3a5d;box-shadow:0 8px 22px rgba(0,0,0,.3);display:none}
  .fill{position:absolute;left:0;top:0;bottom:0;width:10%;background:linear-gradient(90deg,#1dd1a1,#10ac84)}
  .sweet{position:absolute;top:0;bottom:0;left:45%;width:10%;background:repeating-linear-gradient(90deg,rgba(255,255,255,.28) 0 4px,rgba(255,255,255,.12) 4px 8px)}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:150px;background:#0f2d4a;border:1px solid #134668;color:#e6f7ff;padding:8px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);z-index:10;opacity:0;pointer-events:none;transition:opacity .25s ease, transform .25s ease}
  .toast.show{opacity:1;transform:translate(-50%,-6px)}
  .netText{position:fixed;left:50%;transform:translateX(-50%);bottom:125px;color:#b3ecff;text-shadow:0 2px 10px rgba(0,0,0,.5);font-weight:800;opacity:0;transition:opacity .25s ease}
</style>
</head>
<body>
<header>
  <h1>Fishly-AI ‚Äî Dock Fishing</h1>
  <small>Digital clock ‚Ä¢ <strong>Feeding Frenzy 5‚Äì6 PM</strong> (higher bites, clusters, juicy nets)</small>
</header>

<div class="clock" id="clock">
  <div id="clockTime">12:00 PM</div>
  <small id="clockPhase">Day ‚Ä¢ Calm</small>
  <small class="frenzy" id="clockFrenzy" style="display:none">Feeding Frenzy!</small>
</div>

<canvas id="game"></canvas>

<div class="meter" id="meter"><div class="sweet" id="sweet"></div><div class="fill" id="fill"></div></div>

<div class="dockHUD">
  <span class="badge">Coins: <span id="coins">0</span> üí∞</span>
  <button class="btn" id="castBtn">üé£ Cast</button>
  <button class="btn" id="reelBtn" disabled>üåÄ Reel</button>
  <button class="btn danger" id="netBtn">üï∏Ô∏è Net (200)</button>
</div>

<div class="toast" id="toast" role="status" aria-live="polite"></div>
<div class="netText" id="netText">THROWING NET‚Ä¶</div>

<script>
/* ===== Basic utilities ===== */
const $ = s => document.querySelector(s);
const c = $('#game'), ctx = c.getContext('2d');
function resize(){ c.width = innerWidth; c.height = innerHeight; } addEventListener('resize', resize); resize();
let AC=null, soundOn=true;
function ensureAC(){ if(!AC){ AC=new (window.AudioContext||window.webkitAudioContext)(); } }
function beep(f=440,ms=120,g=0.05){ if(!soundOn) return; ensureAC(); const o=AC.createOscillator(),v=AC.createGain(); o.type='sine'; o.frequency.value=f; v.gain.value=g; o.connect(v); v.connect(AC.destination); o.start(); o.stop(AC.currentTime+ms/1000); }
function coinSfx(){ beep(700,70,0.05); setTimeout(()=>beep(1000,60,0.04),60); }
function splashSfx(){ beep(260,120,0.04); setTimeout(()=>beep(360,90,0.03),70); }
function toast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }
const rand=(a,b)=>a+Math.random()*(b-a); const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

/* ===== State ===== */
const state = {
  coins:0,
  casting:false,
  meterT:Math.random(), meterDir:Math.random()<.5?-1:1, sweetStart:.45, sweetWidth:.1,
  bobber:null, ripples:[], sprites:[],
  time:0, // 0..120 (full day)
  frenzy:false, frenzyShown:false
};

/* ===== Simple fish table ===== */
const FISH = [
  {n:"Bluegill", r:"common",  v:[3,6],  color:"#63a46c"},
  {n:"Crappie",  r:"common",  v:[3,7],  color:"#cfd3d6"},
  {n:"Perch",    r:"common",  v:[4,8],  color:"#f2c84b"},
  {n:"Largemouth Bass", r:"uncommon", v:[10,20], color:"#5aa870"},
  {n:"Smallmouth Bass", r:"uncommon", v:[10,22], color:"#9a7b50"},
  {n:"Walleye",  r:"uncommon", v:[12,24], color:"#9bb17a"},
  {n:"Common Carp", r:"uncommon", v:[8,22], color:"#caa23a"},
  {n:"Northern Pike", r:"rare", v:[20,40], color:"#3d6f4d"},
  {n:"Muskellunge", r:"epic", v:[40,80], color:"#4d7f63"},
  {n:"Boot", r:"junk", v:[0,0], color:"#555"},
  {n:"Seaweed", r:"junk", v:[0,1], color:"#55aa66"}
];
const RARITY_W = {common:1.0,uncommon:0.45,rare:0.15,epic:0.05,junk:0.12};

/* ===== UI wiring ===== */
$('#coins').textContent = state.coins;
$('#castBtn').onclick = cast;
$('#reelBtn').onclick = reel;
$('#netBtn').onclick = useNet;

/* ===== Clock & Frenzy (game time) =====
   24h = 120 real sec  ->  1h = 5 sec */
function gameHour(){ return Math.floor(((state.time/120)*24))%24; }
function gameMinute(){ return Math.floor(((state.time/120)*24*60))%60; }
function fmtClock(){
  let h=gameHour(), m=gameMinute(); const ampm=h>=12?'PM':'AM'; let hh=h%12; if(hh===0) hh=12;
  return `${hh}:${String(m).padStart(2,'0')} ${ampm}`;
}
function phaseName(){ const h=gameHour(); if(h<6) return 'Night'; if(h<9) return 'Dawn'; if(h<18) return 'Day'; if(h<21) return 'Dusk'; return 'Night'; }
function checkFrenzy(){
  const h=gameHour();
  const nowFrenzy = (h>=17 && h<18);
  state.frenzy = nowFrenzy;
  $('#clockFrenzy').style.display = nowFrenzy ? '' : 'none';
  if(nowFrenzy && !state.frenzyShown){ state.frenzyShown=true; toast('üêü Feeding Frenzy! 5‚Äì6 PM: hot bite, clusters, juicy nets'); beep(880,100,0.04); }
  if(h===18){ state.frenzyShown=false; } // allow toast again next day
}
function tickClock(dt){
  state.time = (state.time + dt) % 120; // loop days
  $('#clockTime').textContent = fmtClock();
  $('#clockPhase').textContent = `${phaseName()} ‚Ä¢ Calm`;
  checkFrenzy();
}

/* ===== Scene rendering ===== */
function drawScene(){
  // water
  const g=ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,'#0a3a53'); g.addColorStop(.5,'#0c4360'); g.addColorStop(1,'#083048');
  ctx.fillStyle=g; ctx.fillRect(0,0,c.width,c.height);

  // distant land silhouette
  ctx.fillStyle='#08273a'; ctx.fillRect(0,c.height*0.62,c.width,c.height*0.38);

  // dock (foreground)
  const dockY=c.height*0.70;
  ctx.fillStyle='#1e3648'; ctx.fillRect(0,dockY,c.width,c.height-dockY);
  for(let x=0;x<c.width;x+=60){ ctx.fillStyle='#2a4a60'; ctx.fillRect(x,dockY-10,40,10); }

  // ripples
  for(const r of state.ripples){
    ctx.strokeStyle=`rgba(200,240,255,${r.a})`; ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(r.x,r.y,r.r,0,Math.PI*2); ctx.stroke();
  }

  // bobber
  if(state.bobber){
    ctx.beginPath(); ctx.fillStyle='#ff5555'; ctx.arc(state.bobber.x,state.bobber.y,6,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(state.bobber.x,state.bobber.y-3,3,0,Math.PI*2); ctx.fill();
  }

  // fish pop sprites (when caught)
  for(const sp of state.sprites){
    const a = 1 - sp.life/sp.max; ctx.save(); ctx.globalAlpha=Math.max(0,a);
    ctx.translate(sp.x, sp.y - sp.life*90);
    ctx.rotate(Math.sin(sp.life*8)*0.15);
    ctx.fillStyle = sp.color; ctx.strokeStyle='#172b39'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.ellipse(0,0,18,9,0,0,Math.PI*2); ctx.fill(); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(-18,0); ctx.lineTo(-28,-7); ctx.lineTo(-28,7); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.restore();
  }
}

/* ===== Casting / Meter ===== */
const meter = $('#meter'), fill = $('#fill'), sweet = $('#sweet');
function showMeter(show){ meter.style.display = show ? 'block' : 'none'; }
function cast(){
  if(state.casting) return;
  state.casting=true;
  $('#reelBtn').disabled=false;
  $('#castBtn').disabled=true;
  showMeter(true);
  // toss bobber to random spot
  const x = c.width*0.5 + rand(-150,150);
  const y = c.height*0.55 + rand(-40,40);
  state.bobber = {x,y};
  state.ripples.push({x,y,r:6,a:.9});
  splashSfx();
}
function reel(){
  if(!state.casting) return;
  // success if fill center falls within sweet zone
  const pos = state.meterT;
  const center = pos + 0.05;
  const s0 = state.sweetStart, s1 = s0 + state.sweetWidth;
  const success = (center>=s0 && center<=s1);
  const frenzy = state.frenzy;
  const baseBite = success ? 0.85 : 0.35;
  const biteChance = frenzy ? Math.min(1, baseBite + 0.35) : baseBite;
  const bit = Math.random() < biteChance;

  if(bit){
    const cluster = success && (frenzy ? Math.random()<0.85 : Math.random()<0.25);
    const count = cluster ? (frenzy ? 2+Math.floor(Math.random()*3) : 2) : 1;
    let coinsGained = 0;
    for(let i=0;i<count;i++){
      const fish = chooseFish(frenzy);
      const v = Math.round(rand(fish.v[0], fish.v[1]) * (frenzy ? 1.25 : 1.0));
      coinsGained += v;
      popFishSprite(fish);
    }
    state.coins += coinsGained; $('#coins').textContent = state.coins; coinSfx();
    toast(cluster ? `üéâ Cluster catch! +${coinsGained} coins` : `üé£ Nice catch! +${coinsGained} coins`);
  } else {
    toast('‚Ä¶nothing this time. Try again!');
  }

  // reset
  state.casting=false;
  $('#reelBtn').disabled=true;
  $('#castBtn').disabled=false;
  state.bobber=null;
  showMeter(false);
}
function chooseFish(frenzy){
  // assemble weights
  const w = FISH.map(f=>{
    let base = RARITY_W[f.r] ?? 0.05;
    if(f.r==='junk') base = 0.10;
    if(frenzy){
      if(f.r==='common') base*=1.25;
      if(f.r==='uncommon') base*=1.45;
      if(f.r==='rare') base*=1.35;
      if(f.r==='epic') base*=1.25;
      if(f.r==='junk') base*=0.35;
    }
    return base;
  });
  let sum=w.reduce((a,b)=>a+b,0), r=Math.random()*sum;
  for(let i=0;i<FISH.length;i++){ if(r<w[i]) return FISH[i]; r-=w[i]; }
  return FISH[0];
}
function popFishSprite(f){ state.sprites.push({x: state.bobber?state.bobber.x:c.width*.5, y: state.bobber?state.bobber.y:c.height*.55, life:0, max:1.1, color:f.color}); }

/* ===== Net ===== */
function useNet(){
  if(state.casting) return toast('Reel in first!');
  const cost=200; if(state.coins<cost) return toast('Not enough coins for a net (200).');
  state.coins-=cost; $('#coins').textContent=state.coins;
  const el=$('#netText'); el.style.opacity=1; el.textContent='THROWING NET‚Ä¶';
  setTimeout(()=>el.style.opacity=0,700);
  // haul
  const frenzy = state.frenzy;
  const pulls = frenzy ? 6+Math.floor(Math.random()*5) : 2+Math.floor(Math.random()*3);
  let total=0;
  for(let i=0;i<pulls;i++){
    const f = chooseFish(frenzy);
    const v = Math.round(rand(f.v[0], f.v[1]) * (frenzy ? 1.35 : 1.0));
    total += Math.max(0,v);
    // show a few sprites
    if(i<5) state.sprites.push({x:c.width*0.5+rand(-60,60),y:c.height*0.55+rand(-20,20),life:0,max:1.0,color:f.color});
  }
  state.coins += total; $('#coins').textContent=state.coins; coinSfx();
  toast(`üï∏Ô∏è Net haul: +${total} coins ${frenzy?'(FRENZY!)':''}`);
}

/* ===== Meter animation & water ripples ===== */
function update(dt){
  // time & clock
  tickClock(dt);

  // meter
  if(state.casting){
    state.meterT += state.meterDir * dt * 0.35;
    if(state.meterT<0) { state.meterT=0; state.meterDir=1; }
    if(state.meterT>0.9){ state.meterT=0.9; state.meterDir=-1; }
    $('#fill').style.left = (state.meterT*100)+'%';
    // sweet band grows slightly with evening
    state.sweetWidth = 0.1 + (state.frenzy?0.08:0);
    state.sweetStart = 0.5 - state.sweetWidth/2;
    $('#sweet').style.left = (state.sweetStart*100)+'%';
    $('#sweet').style.width = (state.sweetWidth*100)+'%';
  }

  // ripples & sprites
  state.ripples.forEach(r=>{ r.r += dt*80; r.a -= dt*0.8; });
  state.ripples = state.ripples.filter(r=>r.a>0);
  state.sprites.forEach(sp=>{ sp.life+=dt; }); state.sprites = state.sprites.filter(sp=>sp.life<sp.max);
}
let last=performance.now();
function loop(now){
  const dt=Math.min(0.05,(now-last)/1000); last=now;
  // advance game time (24h = 120s)
  state.time = (state.time + dt) % 120;
  update(dt);
  drawScene();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== Initial UI ===== */
toast('Welcome! Cast, then reel inside the sweet zone. 5‚Äì6 PM: Feeding Frenzy!');
</script>
</body>
</html>
